#  Template .NET Core build

#  This template allows you to validate your .NET Core package.
#  The workflow allows running tests and code linting on the default branch.

# To run your pipeline on a Windows machine, create a self-hosted Windows runner.
# For instructions on setting up a Windows runner, see https://support.atlassian.com/bitbucket-cloud/docs/set-up-runners-for-windows/

image: mcr.microsoft.com/dotnet/sdk:6.0

pipelines:
  default:
         - step:
              name: Build and Test
              caches:
                  - dotnetcore
              script:
                  - dotnet restore
                  - dotnet build
                  - dotnet test
  branches:
        master:
            - step:
                  name: "Package"
                  caches:
                      - dotnetcore
                  script:
                      - apt-get update
                      - apt-get install zip -y
                      # Build all from warehouse management
                      - cd management-dddnetcore
                      - dotnet restore
                      - dotnet build
                      # Build all and test tests
                      - cd ..
                      - dotnet restore
                      - dotnet build
                      - dotnet test
                      # Web
                      - dotnet publish -c Release -o ./publish
                      - cd ./publish
#                      - zip -r web.zip .
#                  artifacts:
#                          - publish/web.zip
#                  
            - step:
                  name: Deploy to azure
                  deployment: Production
                  trigger: manual
                  
                  script:
                      - pwd
                      - ls
#                      - pipe: microsoft/azure-web-apps-deploy:1.0.3
#                        variables:
#                            AZURE_APP_ID: $AZURE_APP_ID
#                            AZURE_PASSWORD: $AZURE_PASSWORD
#                            AZURE_TENANT_ID: $AZURE_TENANT_ID
#                            AZURE_RESOURCE_GROUP: "LAPR5"
#                            AZURE_APP_NAME: "21S5DD20SocialGame"
#                            ZIP_FILE: MasterDataSocialNetwork/publish/web.zip
#
#   
